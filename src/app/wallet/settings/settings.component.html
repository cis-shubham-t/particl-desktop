<app-header class="disable-select">
  <div class="tab-group">
    <mat-tab-group (selectChange)="changeTab($event.index)">
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-overview"></mat-icon>
          Main
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-attach"></mat-icon>
          dApps
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-public"></mat-icon>
          Display
        </ng-template>
      </mat-tab>
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon fontSet="partIcon" fontIcon="part-globe"></mat-icon>
          Network
        </ng-template>
      </mat-tab>
    </mat-tab-group>
  </div>
</app-header>

<div class="container-block disable-select" *ngIf="settings">

  <!-- ===== MAIN ===== -->

  <div *ngIf="tabLabels[selectedTab] == 'main'" fxLayout="row" fxLayoutGap="30px">
    <div fxFlex="50">

      <div class="subtitle">General</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.window.autostart" class="checkbox align-top wrap" [(ngModel)]="settings.window.autostart">
              <h4 class="option">Start Particl on system login</h4>
              <p class="desc">Start Particl wallet automatically?</p>
            </mat-checkbox>
          </div>

        </div>
      </mat-card>

      <div class="subtitle">Window behaviour</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.window.tray" class="checkbox align-top wrap" [(ngModel)]="settings.window.tray">
              <h4 class="option">Minimize to the tray</h4>
              <p class="desc">Minimizes the client window to tray instead of the taskbar</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.window.minimize" class="checkbox align-top wrap" [(ngModel)]="settings.window.minimize">
              <h4 class="option">Minimize on close</h4>
              <p class="desc">Don't close the client, keep it running minimized</p>
            </mat-checkbox>
          </div>

        </div>
      </mat-card>

      <div class="subtitle">Transactions</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <h4 class="option">Transaction fees</h4>
            <p class="desc">Optional transaction fee per kB that helps makes sure your transactions are processed quickly (recommended: 0.01 PART)</p>
            <mat-form-field>
              <input matInput type="text" [(ngModel)]="settings.main.feeAmount">
            </mat-form-field>

            <mat-form-field>
              <mat-select [(ngModel)]="settings.main.feeCurrency">
                <mat-option [value]="'part'">
                  PART
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>
      </mat-card>
    </div>
    <div>
      <div class="subtitle">Staking</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.main.stake" class="checkbox align-top wrap" [(ngModel)]="settings.main.stake">
              <h4 class="option">Enable staking</h4>
              <p class="desc">Get staking rewards by securing the network</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Reserve</h4>
            <p class="desc">Reserved amount does not participate in staking and is therefore spendable at any time</p>
            <p class="widget-help">
              Note: changing this option requires you to unlock your wallet (if encrypted) upon save.
            </p>
            <mat-form-field>
              <input matInput type="number" min="0.01" step="0.01" [(ngModel)]="settings.main.reserveAmount" [disabled]="!settings.main.stake">
            </mat-form-field>
            <mat-form-field>
              <mat-select [(ngModel)]="settings.main.reserveCurrency" [disabled]="!settings.main.stake">
                <mat-option value="part">
                  PART
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.main.rewardAddressEnabled" class="checkbox align-top wrap" [(ngModel)]="settings.main.rewardAddressEnabled">
              <h4 class="option">Custom reward address</h4>
              <p class="desc">Choose address that will receive all of your staking rewards</p>
            </mat-checkbox>
            <mat-form-field class="full-width" floatLabel="never">
              <input matInput type="text" placeholder="Enter address" [(ngModel)]="settings.main.rewardAddress" [disabled]="!settings.main.rewardAddressEnabled">
            </mat-form-field>
            <p class="desc">Warning: this will reduce your privacy as all your addresses will be linked together</p>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Foundation donations</h4>
            <p class="desc">Percentage of your stakes donated to Particl Foundation to support development</p>
            <!-- TODO: implement https://material.angular.io/components/slider/overview instead of input if possible (I couldn't get it to work): -->
            <mat-form-field>
              <input matInput type="number" min="10" max="100" [(ngModel)]="settings.main.foundationDonation" [disabled]="!settings.main.stake">
            </mat-form-field>%
          </div>

        </div>
      </mat-card>

    </div>
  </div><!-- << MAIN -->
    

  <!-- ===== DAPPS ===== -->

  <div *ngIf="tabLabels[selectedTab] == 'dapps'" fxLayout="row" fxLayoutGap="30px">
    <div fxFlex="50">

      <div class="subtitle">Marketplace</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.market.enabled" class="checkbox align-top wrap" [(ngModel)]="settings.market.enabled">
              <h4 class="option">Enable Marketplace</h4>
              <p class="desc">Enable/disable Marketplace dApp in Particl Desktop</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Default shipping country <span class="tag">Buyer</span></h4>
            <p class="desc">Select your country for exact shipping and escrow prices calculation</p>
            <mat-select-search
              [options]="countryList?.countries"
              [defaultSelectedValue]="settings.market.defaultCountry"
              [showValueOf]="'name'"
              (onChange)="onCountryChange($event)">
            </mat-select-search>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Listings per page <span class="tag">Buyer</span></h4>
            <p class="desc">How many listings will be shown per page on Marketplace</p>
            <mat-form-field>
              <mat-select [(ngModel)]="settings.market.listingsPerPage" [disabled]="!settings.market.enabled">
                <mat-option [value]="15">
                  15 per page
                </mat-option>
                <mat-option [value]="30">
                  30 per page (default) <!-- 2× ^ -->
                </mat-option>
                <mat-option [value]="45">
                  45 per page <!-- 3× ^ -->
                </mat-option>
                <mat-option [value]="60">
                  60 per page <!-- 3× ^ -->
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Default listing expiration <span class="tag">Seller</span></h4>
            <p class="desc">Choose default listing expiration time for your listings (for how long should the listings be published on Marketplace)</p>
            <mat-form-field>
              <mat-select [(ngModel)]="settings.market.listingExpiration" [disabled]="!settings.market.enabled">
                <mat-option [value]="4">
                  4 days (default)
                </mat-option>
                <mat-option [value]="7">
                  1 week
                </mat-option>
                <mat-option [value]="14">
                  2 weeks
                </mat-option>
                <mat-option [value]="21">
                  3 weeks
                </mat-option>
                <mat-option [value]="28">
                  4 weeks
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>
      </mat-card>

    </div>
    <div fxFlex="50">
      &nbsp;
    </div>
  </div><!-- << DAPPS -->


  <!-- ===== DISPLAY ===== -->

  <div *ngIf="tabLabels[selectedTab] == 'display'" fxLayout="row" fxLayoutGap="30px">
    <div fxFlex="50">

      <div class="subtitle">User interface</div>
      <mat-card class="card">
        <div class="list section">

          <div class="row" fxLayout="row">
            <div class="item" fxFlex="50">
              <h4 class="option">Language</h4>
              <p class="desc">Select your preferred language</p>
              <mat-form-field>
                <mat-select [(ngModel)]="settings.display.language">
                  <mat-option [value]="'en'">English (default)</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="item" fxFlex="50">
              <h4 class="option">Theme</h4>
              <p class="desc">Select default theme</p>
              <mat-form-field>
                <mat-select [(ngModel)]="settings.display.theme">
                  <mat-option [value]="'light'">Light (default)</mat-option>
                  <mat-option [value]="'dark'">Dark</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Items per page</h4>
            <p class="desc">Select number of items per page (receive addresses, history transactions, address book entries)</p>
            <!-- FIXME: needs implementation -->
            <mat-form-field>
              <mat-select [(ngModel)]="settings.display.rows">
                <mat-option [value]="10">10</mat-option>
                <mat-option [value]="20">20</mat-option>
                <mat-option [value]="50">50</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.display.advanced" class="checkbox align-top wrap" [(ngModel)]="settings.display.advanced">
              <h4 class="option">Advanced options by default</h4>
              <p class="desc">Always display advanced options (coin control and narrations)</p>
            </mat-checkbox>
          </div>

        </div>
      </mat-card>

      <div class="subtitle">Navigation</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <h4 class="option">Expanded menu sections</h4>
            <p class="desc">Select which menu section should be expanded by default</p>
            <hr class="divider transparent">
            <div class="row" fxLayout>
              <div class="item" fxFlex="50">
                <mat-checkbox [value]="settings.navigation.marketExpanded" class="checkbox align-top wrap" [(ngModel)]="settings.navigation.marketExpanded">
                  <h4 class="option">Market</h4>
                </mat-checkbox>
              </div>
              <div class="item" fxFlex="50">
                <mat-checkbox [value]="settings.navigation.walletExpanded" class="checkbox align-top wrap" [(ngModel)]="settings.navigation.walletExpanded">
                  <h4 class="option">Wallet</h4>
                </mat-checkbox>
              </div>
            </div>
          </div>

        </div>
      </mat-card>

    </div>
    <div fxFlex="50">

      <div class="subtitle">Units &amp; Currencies</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <h4 class="option">Amount units</h4>
            <p class="desc">Unit to show amounts in (PART)</p>
            <mat-form-field>
              <mat-select [(ngModel)]="settings.display.units">
                <mat-option value="part">PART (default)</mat-option>
                <mat-option value="mpart">mPART (0.001 PART)</mat-option>
                <mat-option value="upart">µPART (0.000001 PART)</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Fiat countervalue</h4>
            <p class="desc">Default fiat currency values</p>
            <mat-form-field>
              <mat-select [(ngModel)]="settings.display.fiat">
                <mat-option value="usd">US Dollar (USD)</mat-option>
                <mat-option value="eur">Eurozone Euro (EUR)</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

        </div>
      </mat-card>

      <div class="subtitle">Notifications</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.display.notifyPayments" class="checkbox align-top wrap" [(ngModel)]="settings.display.notifyPayments">
              <h4 class="option">Received payments</h4>
              <p class="desc">Show notification for incoming payments</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.display.notifyStakes" class="checkbox align-top wrap" [(ngModel)]="settings.display.notifyStakes">
              <h4 class="option">Staking rewards</h4>
              <p class="desc">Show notification for new staking rewards</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.display.notifyOrders" class="checkbox align-top wrap" [(ngModel)]="settings.display.notifyOrders">
              <h4 class="option">Order changes <span class="tag">Marketplace</span></h4>
              <p class="desc">Show notifications for order updates that need your attention</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <mat-checkbox [value]="settings.display.notifyProposals" class="checkbox align-top wrap" [(ngModel)]="settings.display.notifyProposals">
              <h4 class="option">Active Proposals</h4>
              <p class="desc">Show notification for Proposals that are ready for voting</p>
            </mat-checkbox>
          </div>

        </div>
      </mat-card>

    </div>
  </div><!-- << DISPLAY -->


  <!-- ===== NETWORK ===== -->
  
  <div *ngIf="tabLabels[selectedTab] == 'network'" fxLayout="row" fxLayoutGap="30px">
    <div fxFlex="50">

      <div class="subtitle">Network settings</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.network.upnp" class="checkbox align-top wrap" [(ngModel)]="settings.network.upnp">
              <h4 class="option">Map port using UPnP</h4>
              <p class="desc">UPnP is a set of networking protocols that permits networked devices to seamlessly
                discover each other's presence on the network without the need for port forwarding. (???)</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="item">
            <h4 class="option">Port forwarding</h4>
            <p class="desc">Alternatively, you can configure your router to forward port <code>51738</code></p>
          </div>

        </div>
      </mat-card>

      <!--div class="subtitle">TOR</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox class="checkbox align-top wrap">
              <h4 class="option">Enable TOR</h4>
              <p class="desc">xxx</p>
            </mat-checkbox>
          </div>

        </div>
      </mat-card-->

    </div>
    <div fxFlex="50">

      <div class="subtitle">Proxy</div>
      <mat-card class="card">
        <div class="list section">

          <div class="item">
            <mat-checkbox [value]="settings.network.proxy" class="checkbox align-top wrap" [(ngModel)]="settings.network.proxy">
              <h4 class="option">Connect through Socks proxy</h4>
              <p class="desc">???</p>
            </mat-checkbox>
          </div>

          <hr class="divider">

          <div class="row" fxLayout="row">
            <div class="item" fxFlex="50">
              <h4 class="option">Proxy IP</h4>
              <p class="desc">??? (default: 127.0.0.1)</p>
              <mat-form-field>
                <input matInput type="text" id="ip" [(ngModel)]="settings.network.proxyIP" [disabled]="!settings.network.proxy">
              </mat-form-field>
            </div>
            <div class="item" fxFlex="50">
              <h4 class="option">Port</h4>
              <p class="desc">??? (default: 9050)</p>
              <mat-form-field>
                <input matInput type="text" id="port" [(ngModel)]="settings.network.proxyPort" [disabled]="!settings.network.proxy">
              </mat-form-field>
            </div>
          </div>

        </div>
      </mat-card>

    </div>
  </div><!-- << NETWORK -->



  <div class="actions">
    <div class="left">
      <button mat-button (click)="cancel()" color="warn">
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-cross"></mat-icon>
        Cancel
      </button>
      <button (click)="resetAll()" mat-button color="basic">
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-refresh"></mat-icon>
        Reset all to defaults
      </button>
    </div>
    <div class="right">
      <button mat-raised-button (click)="save()" color="primary" class="validate">
        <mat-icon class="icon" fontSet="partIcon" fontIcon="part-lock"></mat-icon>
        Save changes
      </button>
    </div>
  </div>

</div><!-- .container-block.disable-select -->